{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Helix-TTD Audit Block",
  "description": "Schema for a single immutable record in the Trusted Traceability Chain.",
  "type": "object",
  "required": [
    "block_id",
    "timestamp",
    "previous_hash",
    "actor",
    "action",
    "context",
    "signature"
  ],
  "properties": {
    "block_id": {
      "type": "string",
      "description": "Unique UUID for this block."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of execution."
    },
    "previous_hash": {
      "type": "string",
      "description": "SHA-256 hash of the preceding block (N-1)."
    },
    "actor": {
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "role": { "type": "string", "enum": ["REQUESTER", "APPROVER", "OPS_ENGINEER", "SYSTEM"] }
      },
      "required": ["id", "role"]
    },
    "action": {
      "type": "object",
      "properties": {
        "type": { "type": "string" },
        "target_resource": { "type": "string" },
        "parameters": { "type": "object" }
      },
      "required": ["type", "target_resource"]
    },
    "context": {
      "type": "object",
      "description": "Metadata regarding the environment, reality check labels, or justification.",
      "properties": {
        "reality_label": { "type": "string", "enum": ["FACT", "HYPOTHESIS", "SPECULATION"] },
        "tpaf_id": { "type": "string" }
      }
    },
    "signature": {
      "type": "string",
      "description": "Cryptographic signature of the block content by the Actor."
    }
  }
}
